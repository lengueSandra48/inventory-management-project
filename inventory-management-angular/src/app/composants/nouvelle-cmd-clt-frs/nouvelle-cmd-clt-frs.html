<div class="page-container">
  <div class="col-md-12 mb-3">
    <h2><i class="fas fa-shopping-cart blue-color"></i>&nbsp;{{ getPageTitle() }}</h2>
  </div>
  <div class="alert alert-danger" *ngIf="errorMsg.length">
    <div *ngFor="let msg of errorMsg">
      <span> {{msg}}</span>
    </div>
  </div>
  <div class="data-table-container">
    <div class="form-section">
      <div class="row">
        <div class="col-md-5">
          <form>
            <div class="form-group mb-3">
              <label for="codecmd" class="form-label"><strong>Code commande</strong></label>
              <input type="text" class="form-control" id="codecmd" placeholder="Saisir le code de la commande" name="codecmd" [(ngModel)]="codeCommande" >
            </div>
            <div class="form-group mb-3">
              <label for="datecommande" class="form-label"><strong>Date commande</strong></label>
              <input type="date" class="form-control" id="datecommande" placeholder="Date de la commande">
            </div>
            <div class="form-group mb-3">
              <label for="cltfrs" class="form-label"><strong>{{ origin === 'client' ? 'Client' : 'Fournisseur' }}</strong></label>
              <select class="form-control" id="cltfrs" aria-label="Default select example" name="cltfrs" [(ngModel)]="selectedClientFournisseur">
                <option selected>Sélectionner un {{ origin }}</option>
                <option *ngFor="let obj of listClientsFournisseurs" [ngValue]="obj">
                  {{ obj.nom }}&nbsp;{{obj.prenom}}
                </option>
              </select>
            </div>
          </form>
        </div>

        <div class="col-md-5" *ngIf="selectedClientFournisseur.nom">
          <div class="client-info">
            <div class="info-row">
              <i class="fas fa-info-circle"></i>
              <span>Nom: {{ selectedClientFournisseur.nom }}</span>
            </div>
            <div class="info-row">
              <i class="fas fa-info-circle"></i>
              <span>Prénom: {{ selectedClientFournisseur.prenom }}</span>
            </div>
            <div class="info-row">
              <i class="fas fa-phone-alt"></i>
              <span>Tél: {{ selectedClientFournisseur.numTel }}</span>
            </div>
            <div class="info-row">
              <i class="fas fa-hourglass-half"></i>
              <span class="text-primary">En préparation</span>
            </div>
          </div>
        </div>

        <div class="col-md-2 text-center" *ngIf="selectedClientFournisseur.nom">
          <img [src]="selectedClientFournisseur.photo ? selectedClientFournisseur.photo : 'product.png'" alt="" class="rounded-circle" width="120px">
        </div>
      </div>
    </div>

    <div class="form-section">
      <form>
        <div class="row">
          <div class="col-md-3">
            <label for="codearticle" class="form-label"><strong>Code article</strong></label>
            <input type="text" class="form-control" id="codearticle" placeholder="Rechercher un article" name="codearticle" [(ngModel)]="codeArticle" (input)="searchArticle()">
            <div *ngIf="codeArticle.length && !articleNotYetSelected" class="autocomplete shadow p-3 bg-white rounded">
              <p class="p-1" *ngFor="let article of listArticle"
                  (click)="selectArticle(article)"
                  (keydown)="selectArticle(article)"
              >
                {{article.codeArticle}}&nbsp; {{article.designation}}
              </p>
            </div>
          </div>
          <div class="col-md-3">
            <label for="quantite" class="form-label"><strong>Quantité</strong></label>
            <input type="number" class="form-control" id="quantite" placeholder="Saisir la quantité" name="quantite" [(ngModel)]="quantite">
          </div>
          <div class="col-md-3">
            <label for="prixunitttc" class="form-label"><strong>Prix unitaire (€)</strong></label>
            <input type="number" class="form-control" id="prixunitttc" placeholder="Prix unitaire TTC" name="prixunitttc" [(ngModel)]="searchArticleDto.prixUnitaireTtc">
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button type="button" class="btn btn-success w-100" (click)="ajouterLigneCommande()" title="Ajouter l'article">
              <i class="fas fa-plus"></i> Ajouter
            </button>
          </div>
        </div>
      </form>
    </div>
    <div class="form-section">
      <h4 class="section-title">Articles de la commande</h4>
      <div class="lignes-commande" style="max-height: 300px; overflow-y: auto;">
        <div *ngIf="lignesCommande.length === 0" class="empty-state">
          <i class="fas fa-shopping-cart"></i>
          <p>Aucun article ajouté à la commande</p>
        </div>
        <app-detail-cmd
          *ngFor="let ligne of lignesCommande"
          [ligneCommande]="ligne"
          (supprimerLigneEvent)="supprimerLigneCommande($event)">
        </app-detail-cmd>
      </div>
    </div>
    
    <div class="form-section text-end">
      <h3 class="total-commande">Total de la commande: {{ totalCommande }}</h3>
    </div>
  </div>

  <div class="page-actions">
    <button class="btn btn-danger me-3" (click)="cancel()">
      <i class="fas fa-ban"></i>
      Annuler
    </button>
    <button class="btn btn-primary" (click)="enregistrerCommande()">
      <i class="fas fa-save"></i>
      Enregistrer
    </button>
  </div>
</div>

