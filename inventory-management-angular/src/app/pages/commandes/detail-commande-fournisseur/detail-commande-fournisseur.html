<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
          <h3 class="mb-0">
            <i class="fas fa-file-invoice mr-2"></i>
            Détail de la Commande Fournisseur
          </h3>
          <div class="btn-group">
            <button type="button" class="btn btn-outline-light btn-sm" (click)="retourListe()">
              <i class="fas fa-arrow-left mr-1"></i>
              Retour
            </button>
            <button type="button" class="btn btn-warning btn-sm" (click)="modifierCommande()">
              <i class="fas fa-edit mr-1"></i>
              Modifier
            </button>
            <button type="button" class="btn btn-danger btn-sm" (click)="supprimerCommande()">
              <i class="fas fa-trash mr-1"></i>
              Supprimer
            </button>
          </div>
        </div>

        <div class="card-body" *ngIf="!loading && !errorMsg">
          <div class="detail-grid">
            <div class="detail-section">
              <h4 class="section-title">Informations générales</h4>
              <div class="detail-row">
                <span class="detail-label">Code commande:</span>
                <span class="detail-value">{{ commande.code || 'Non trouvé' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Date commande:</span>
                <span class="detail-value">{{ commande.dateCommande ? (commande.dateCommande | date:'dd/MM/yyyy') : 'Non trouvé' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">État:</span>
                <span class="detail-value">
                  <span class="badge badge-info">{{ commande.etatCommande || 'EN_PREPARATION' }}</span>
                </span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Nombre d'articles:</span>
                <span class="detail-value">{{ getNbArticles() }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Total commande:</span>
                <span class="detail-value total-amount">{{ getTotalCommande() | currency:'EUR':'symbol':'1.2-2' }}</span>
              </div>
            </div>

            <div class="detail-section">
              <h4 class="section-title">Informations fournisseur</h4>
              <div class="detail-row">
                <span class="detail-label">Nom:</span>
                <span class="detail-value">{{ fournisseurInfo?.nom || 'Non trouvé' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Prénom:</span>
                <span class="detail-value">{{ fournisseurInfo?.prenom || 'Non trouvé' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Email:</span>
                <span class="detail-value">{{ fournisseurInfo?.email || 'Non trouvé' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Téléphone:</span>
                <span class="detail-value">{{ fournisseurInfo?.numTel || fournisseurInfo?.telephone || 'Non trouvé' }}</span>
              </div>
            </div>
          </div>

          <!-- Lignes de commande -->
          <div class="lignes-section" *ngIf="commande.ligneCommandeFournisseurs && commande.ligneCommandeFournisseurs.length > 0">
            <h4 class="section-title">Articles commandés</h4>
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Article</th>
                    <th>Code article</th>
                    <th>Quantité</th>
                    <th>Prix unitaire</th>
                    <th>Total ligne</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let ligne of commande.ligneCommandeFournisseurs">
                    <td>{{ ligne.article?.designation || 'Article non trouvé' }}</td>
                    <td>{{ ligne.article?.codeArticle || 'N/A' }}</td>
                    <td class="text-center">{{ ligne.quantite }}</td>
                    <td class="text-right">{{ ligne.prixUnitaire | currency:'EUR':'symbol':'1.2-2' }}</td>
                    <td class="text-right font-weight-bold">{{ (ligne.quantite * ligne.prixUnitaire) | currency:'EUR':'symbol':'1.2-2' }}</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr class="table-info">
                    <td colspan="4" class="text-right font-weight-bold">Total général:</td>
                    <td class="text-right font-weight-bold">{{ getTotalCommande() | currency:'EUR':'symbol':'1.2-2' }}</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- Message si aucune ligne de commande -->
          <div class="alert alert-info" *ngIf="!commande.ligneCommandeFournisseurs || commande.ligneCommandeFournisseurs.length === 0">
            <i class="fas fa-info-circle mr-2"></i>
            Aucun article dans cette commande fournisseur.
          </div>
        </div>

        <!-- Loading state -->
        <div class="card-body text-center" *ngIf="loading">
          <div class="spinner-border text-success" role="status">
            <span class="sr-only">Chargement...</span>
          </div>
          <p class="mt-2">Chargement des informations de la commande...</p>
        </div>

        <!-- Error state -->
        <div class="card-body" *ngIf="errorMsg">
          <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            {{ errorMsg }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
